<div style="display: flex; flex-direction: column; height: 100%;">
  <header>
    <app-menu-button [fullMenuState]="false" [logoutState]="true"></app-menu-button>
    <h1>设备参数设置</h1>
  </header>
  <!-- <nz-divider></nz-divider> -->
  <!-- <nz-spin nzTip='设备未连接' [nzSpinning]="!_ms.state.a1 || !_ms.state.a2"> -->
  <!-- <nz-spin nzTip='设备未连接' [nzSpinning]="false" style="height: 100%;">
    </nz-spin> -->
  <main style="flex: 1;">
    <nz-card style="width: 100%; height: 100%">
      <nz-tabset nzSize="large">
        <!-- <nz-tab nzTitle="基础参数">
          <div style="display: flex;">
            <nz-form-item style="flex: 1;">
              <nz-form-label [nzSpan]="4">联机模式</nz-form-label>
              <nz-form-control [nzSpan]="18">
                <nz-radio-group [(ngModel)]="connectRadio" (ngModelChange)="onConnect($event)">
                  <label nz-radio nzValue="1">单机</label>
                  <label nz-radio nzValue="2">连接</label>
                </nz-radio-group>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item style="flex: 1;">
              <nz-form-label nzSpan="4">连接模式</nz-form-label>
              <nz-form-control [nzSpan]="18">
                <nz-radio-group [(ngModel)]="modeRadio" (ngModelChange)="onMode($event)">
                  <label nz-radio nzValue="1">一泵一顶</label>
                  <label nz-radio nzValue="2">一泵两顶</label>
                </nz-radio-group>
              </nz-form-control>
            </nz-form-item>
          </div>
          <nz-divider></nz-divider>
          <div class="item">
            <nz-form-item>
              <nz-input-group nzAddOnBefore="PLC模拟量值">
                <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [value]="_ms.deviceParameter?.simulationValue"
                  (change)="onBaseSet(514, $event)">
              </nz-input-group>
            </nz-form-item>
            <nz-form-item>
              <nz-input-group nzAddOnBefore="压力传感器上限">
                <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [value]="_ms.deviceParameter?.mpaSensorUpperLimit"
                  (change)="onBaseSet(515, $event)">
              </nz-input-group>
            </nz-form-item>
            <nz-form-item>
              <nz-input-group nzAddOnBefore="位移传感器上限">
                <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [value]="_ms.deviceParameter?.mmSensorUpperLimit"
                  (change)="onBaseSet(516, $event)">
              </nz-input-group>
            </nz-form-item>
          </div>
        </nz-tab> -->
        <nz-tab nzTitle="安全参数">
          <!-- <div style="display: flex;">
            <nz-form-item style="flex: 1;">
              <nz-form-label [nzSpan]="4">联机模式</nz-form-label>
              <nz-form-control [nzSpan]="18">
                <nz-radio-group [(ngModel)]="connectRadio" (ngModelChange)="onConnect($event)">
                  <label nz-radio nzValue="1">单机</label>
                  <label nz-radio nzValue="2">连接</label>
                </nz-radio-group>
              </nz-form-control>
            </nz-form-item>
          </div> -->
          <nz-divider nzText="主站" nzOrientation="left"></nz-divider>
          <form class="item" *ngIf="baseForm" nz-form [formGroup]="baseForm.formGroup">
            <nz-form-item *ngFor="let field of baseForm.formTypes">
              <nz-form-label [nzSpan]="8">{{field.prefix}}</nz-form-label>
              <nz-form-control [nzSpan]="16" [ngSwitch]="field.type">
                <nz-input-group [nzAddOnAfter]="field.after" *ngIf="field.key !== 'modeRadio'">
                  <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [formControlName]="field.key">
                </nz-input-group>

                <nz-radio-group [formControlName]="field.key" *ngIf="field.key === 'modeRadio'">
                  <label nz-radio *ngFor="let radio of field.radio" [nzValue]="radio.value">{{radio.name}}</label>
                </nz-radio-group>

                <nz-form-explain *ngIf="baseForm.formGroup.controls[field.key].errors">
                  <ng-container>
                    {{baseForm.formGroup.controls[field.key].errors | formError: field.errors }}
                  </ng-container>
                </nz-form-explain>
              </nz-form-control>
            </nz-form-item>

          </form>
          <div *ngIf="_appService.editState">
            <button (click)="baseSave()" nz-button >保 存</button>
            <button (click)="cancel()" nz-button>取 消</button>
          </div>
          <nz-divider nzText="从站" *ngIf="baseFormC" nzOrientation="left"></nz-divider>
          <form class="item" *ngIf="baseFormC" nz-form [formGroup]="baseFormC.formGroup">
              <nz-form-item *ngFor="let field of baseFormC.formTypes">
                <nz-form-label [nzSpan]="8">{{field.prefix}}</nz-form-label>
                <nz-form-control [nzSpan]="16" [ngSwitch]="field.type">
                  <nz-input-group [nzAddOnAfter]="field.after" *ngIf="field.key !== 'modeRadio'">
                    <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [formControlName]="field.key" >
                  </nz-input-group>

                  <nz-radio-group [formControlName]="field.key" *ngIf="field.key === 'modeRadio'">
                    <label nz-radio *ngFor="let radio of field.radio" [nzValue]="radio.value">{{radio.name}}</label>
                  </nz-radio-group>
                </nz-form-control>
              </nz-form-item>
            </form>
            <div *ngIf="baseFormC" >
              <nz-divider nzText="注意事项" nzOrientation="left"></nz-divider>
              <h3>主/从设置参数必须相同</h3>
              <h3>联机模式：保证设备在连接正常状态下设置参数</h3>
            </div>
        </nz-tab>
        <nz-tab nzTitle="自动控制参数">
          <!-- <div class="item">
            <nz-form-item>
              <nz-input-group nzAddOnBefore="允许偏差率上限" nzAddOnAfter="%">
                <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [value]="_ms.deviceParameter?.maximumDeviationRate"
                  (change)="onSet(508, $event)">
              </nz-input-group>
            </nz-form-item>
            <nz-form-item>
              <nz-input-group nzAddOnBefore="允许偏差率下限" nzAddOnAfter="%">
                <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [value]="_ms.deviceParameter?.LowerDeviationRate"
                  (change)="onSet(509, $event)">
              </nz-input-group>
            </nz-form-item>
            <nz-form-item>
              <nz-input-group nzAddOnBefore="允许压力偏差" nzAddOnAfter="Mpa">
                <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [value]="_ms.deviceParameter?.mpaDeviation"
                  (change)="onSet(510, $event, 'mpa')">
              </nz-input-group>
            </nz-form-item>
            <nz-form-item>
              <nz-input-group nzAddOnBefore="平衡控制" nzAddOnAfter="mm">
                <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [value]="_ms.deviceParameter?.mmBalanceControl"
                  (change)="onSet(511, $event, 'mm')">
              </nz-input-group>
            </nz-form-item>
            <nz-form-item>
              <nz-input-group nzAddOnBefore="倒顶位移下限" nzAddOnAfter="mm">
                <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [value]="_ms.deviceParameter?.mmReturnLowerLimit"
                  (change)="onSet(512, $event, 'mm')">
              </nz-input-group>
            </nz-form-item>
            <nz-form-item>
              <nz-input-group nzAddOnBefore="卸荷完成延时" nzAddOnAfter="s">
                <input (focus)="$event.target.select()" type="number" nz-input nzSize="large" [value]="_ms.deviceParameter?.unloadingDelay"
                  (change)="onSet(513, $event, 's')">
              </nz-input-group>
            </nz-form-item>
          </div> -->
        </nz-tab>
      </nz-tabset>
    </nz-card>
  </main>
</div>
